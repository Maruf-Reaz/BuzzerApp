@model Dynamo.Model.Exam.Question

@{
    ViewData["Title"] = "Question";
}

@section Css {
    <link rel="stylesheet" href="~/vendor/sweetalert2/dist/sweetalert2.min.css" asp-append-version="true">
    <link rel="stylesheet" href="~/vendor/flipclock/flipclock.css" asp-append-version="true">
}

@section Sole {
    <link href="~/css/buzzer-button.css" rel="stylesheet" />
    <link href="~/vendor/fonts/Kiron/Kiron.css" rel="stylesheet" />
    <style>

        .exam-table-section {
            background-image: url("/img/bg-2.jpg");
            background-position: center center;
            background-repeat: no-repeat;
            background-size: cover;
            min-height: 100vh;
            padding-bottom: 150px;
            padding-top: 100px;
        }

        .table td, .table th {
            padding: 1rem !important;
            letter-spacing: -0.17px !important;
            text-transform: none !important;
            vertical-align: middle;
        }

        .table th {
            font-size: 16px !important;
            color: #ffffff !important;
            background-color: #00AEAC;
            border-color: #009DA6;
            border-top: 0 !important;
            border-bottom: 0 !important;
        }

            .table th:first-child {
                border-left: 0 !important
            }

            .table th:last-child {
                border-right: 0 !important
            }

        .table td {
            border-color: #e1e2e2 !important;
            border-top: 0 !important;
            font-family: "Kiron", sans-serif;
            color: #666;
            font-size: 23px;
        }

        .custom-control-label::before,
        .custom-control-label::after {
            top: 6px;
        }
            .table td:first-child {
                border-left: 0 !important;
            }

            .table td:last-child {
                border-right: 0 !important;
                width: 50px;
            }

        .table > tbody > tr:nth-child(2n) > td {
            background-color: #f0f0f0;
        }

        .table > tbody > tr:nth-child(2n+1) > td {
            background-color: rgba(240,240,240,0.2);
        }

        .table-responsive {
            border-radius: 5px;
        }

        .exam-table-heading {
            font-family: 'Fredoka One', cursive;
            font-size: 3.333em;
            color: #023661;
        }

        .img-copter {
            /*right: 5%;
            top: 18%;
            transform: rotate(-18deg);*/
            right: 2%;
            bottom: 100px;
            transform: rotate(-15deg);
        }

        .img-cloud1 {
            top: -170px;
            left: 3%;
            animation-name: floating;
            animation-duration: 3s;
            animation-iteration-count: infinite;
        }

        .exam-id {
            color: #969899;
            border: 2px solid #f0f0f0 !important;
            padding: 0 1.5em;
            font-size: 18px;
            font-style: normal;
            text-transform: capitalize;
            height: 62px;
            width: 400px;
        }

        .backtolist {
            height: 62px;
            padding: 1.3rem 3em !important;
            font-size: 18px !important;
            line-height: 16px !important;
        }

        .canswer {
            min-width: 150px;
        }

        .flip-clock-wrapper {
            max-width: 460px;
            margin: 3em auto 2em;
            display: flex;
            justify-content: center;
        }

        .flip-clock-divider.seconds .flip-clock-label {
            right: -110px;
            font-size: 20px;
        }

        .flip-clock-divider.minutes .flip-clock-label {
            right: -106px;
            font-size: 20px;
        }

        .student-table {
            margin-top: 80px
        }

        .custom-control-label {
            font-size: 22px !important;
        }

        label {
            margin-bottom: 0;
        }

        #submitButton.bubbly-button {
            padding: .2em 1em;
        }
    </style>
}

<section class="exam-table-section">
    <div class="container-fluid">
        <div class="text-center mb-4">
@*<p class="text-uppercase exam-table-heading pt-5">Question</p>
    <div class="d-flex justify-content-center">
        <input type="text" class="text-center form-control rounded-pill exam-id" name="name" value="@ViewBag.Exam.Name" disabled />
    </div>
    <input type="hidden" class="form-control " id="examId" name="examId" value="@ViewBag.Exam.Id" />*@

            <img class="position-absolute img-copter" src="~/img/home/plain.png" alt="..." />
            <img class="position-absolute img-cloud1" src="~/img/home/cloud_1.png" alt="..." />
        </div>
        <div class="p-0">
            <div asp-validation-summary="ModelOnly" class="text-danger"></div>
            <div class="row">
                <div class="col-md-12">

@if (ViewBag.UserId == "8e09035f-c640-4ac0-8d5c-4a63d3eddfab")
{
    <div class="clockAdmin"></div>


}

else
{
    <div class="clockStudent"></div>

    <div class="card student-table" id="main_card">
    <div class="card-body p-0">
    <div class="table-responsive">
    <table class="table table-striped table-bordered" id="main_table">
    <thead class="">
    <tr>
    <th class="text-justify text-wrap">Option 1</th>
    <th class="text-justify text-wrap">Option 2</th>
    <th class="text-justify text-wrap">Option 3</th>
    <th class="text-justify text-wrap">Option 4</th>
    <th class="text-justify text-wrap">Action</th>
    </tr>

    </thead>
    <tbody id="table_body" class="table_body">
    @foreach (var question in ViewBag.Questions)
    {
        <tr>
        <td colspan="6" class="text-wrap">
        @question.Description
        </td>
        </tr>
        <tr>
        <td class="text-wrap">
        <label class="custom-control custom-checkbox">
        <input type="checkbox" class="custom-control-input option" value="1">
        <span class="custom-control-label">
        @question.Option1
        </span>
        </label>

        </td>
        <td class="text-wrap">

        <label class="custom-control custom-checkbox">
        <input type="checkbox" class="custom-control-input option" value="2">
        <span class="custom-control-label">
        @question.Option2
        </span>
        </label>
        </td>
        <td class="text-wrap">

        <label class="custom-control custom-checkbox">
        <input type="checkbox" class="custom-control-input option" value="3">
        <span class="custom-control-label">
        @question.Option3
        </span>
        </label>
        </td>
        <td class="text-wrap">
        <label class="custom-control custom-checkbox">
        <input type="checkbox" class="custom-control-input option" value="4">
        <span class="custom-control-label">
        @question.Option4
        </span>
        </label>
        </td>
        <td class="">

        <div class="text-center">
        <input type="hidden" class="examQuestionId" name="examQuestionId" id="examQuestionId" value="@question.Id" />
        <input class="btn btn-success btn-sm save_button " type="button" name="save_button" id="save_button" value="Save" />
        <input class="btn btn-default btn-sm edit_button " type="button" hidden name="edit_button" id="edit_button" value="Edit" />

        </div>
        </td>
        </tr>
    }


    </table>
    </div>
    </div>
    </div>

    <div class="col-12" id="submit_div">
    <div class="text-center">
    <input class="bubbly-button mb-3" type="button" name="name" id="submitButton" value="Submit">
    </div>
    </div>
}
                </div>
            </div>
        </div>
    </div>
</section>

@section Scripts {
    <script src="~/vendor/sweetalert2/dist/sweetalert2.min.js" asp-append-version="true"></script>
    <script src="~/vendor/flipclock/flipclock.min.js" asp-append-version="true"></script>
    <script type="text/javascript">
        var clock;

        $(document).ready(function () {


            var examId = @ViewBag.Exam.Id ;
            clockAdmin = $('.clockAdmin').FlipClock(10, {
                clockFace: 'MinuteCounter',
                countdown: true,
                autoStart: false,
                callbacks: {
                    start: function () {
                        var audio = new Audio('/audio/Bell-ding-loud.mp3');
                        audio.play();
                    },


                    stop: function () {
                        connection.invoke("StopMcqs", examId).catch(function (err) {
                            return console.error(err.toString());
                        });
                    }
                }
            });
            clockStudent = $('.clockStudent').FlipClock(10, {
                clockFace: 'MinuteCounter',
                countdown: true,
                autoStart: false,
                callbacks: {

                }
            });


            clockAdmin.start();
            clockStudent.start();



            $('.option').on('click', function () {

                var row = $(this).closest('tr');
                row.find(":checkbox[value=1]").prop("checked", false);
                row.find(":checkbox[value=2]").prop("checked", false);
                row.find(":checkbox[value=3]").prop("checked", false);
                row.find(":checkbox[value=4]").prop("checked", false);
                var checkedValue = $(this).val();
                row.find(":checkbox[value=" + checkedValue+"]").prop("checked", true);

            });


            $('#submitButton').on('click', function () {

                $('#main_card').empty();
                $('#submit_div').empty();
            });


            $('.save_button').on('click', function () {
                //var examId = $("#examId").val();

                var row = $(this).closest('tr');
                var checkedValue = row.find('.option:checked').val();
                var examQuestionId = row.find('.examQuestionId').val();

                $(this).val('Saved');
                $(this).attr("disabled", true);
                row.find('.edit_button').attr("hidden", false);
                var url = '@Url.Action("AddAnswer", "Exams")';
                $.ajax({
                    type: "POST",
                    dataType: 'json',
                    url: url,
                    data: {
                        checkedValue: checkedValue,

                        examQuestionId: examQuestionId,
                    },
                    cache: false,
                    success: function (result) {
                        row.find('.option').attr("disabled", true);
                    }
                });
            });

            $('.edit_button').on('click', function () {
                var row = $(this).closest('tr');
                row.find('.option').attr("disabled", false);
                row.find('.save_button').attr("disabled", false);
                row.find('.save_button').val('Save');
            });

            var connection = new signalR.HubConnectionBuilder().withUrl("/signalServer").build();
            connection.on("Receive", function (user, message) {
                getChatNumber();
            });
            connection.start().then(function () {



            }).catch(function (err) {

                return console.error(err.toString());
            });






        });
    </script>

    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
}
